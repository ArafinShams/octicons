<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://unpkg.com/primer-css@9.4.0/build/build.css">
  </head>
  <body class="p-responsive py-4 container-md">
    <h1 class="mb-2">Panocticon</h1>

    <h4 class="text-gray text-normal mb-4">
      Change the options to see new images, then click to download.
    </h4>

    <div class="d-flex">

      <div class="mr-4 pt-2 text-center">
        {% set url = '{color}/{symbol}@{size}.{format}' %}
        <a data-href="{{ url }}" class="d-block border rounded-2 bg-white px-4 pt-1 pb-2 mb-4">
          <div class="text-bold text-gray-dark mb-2">on white</div>
          <img>
        </a>
        <a data-href="{{ url }}" class="d-block border rounded-2 bg-gray px-4 pt-1 pb-2 my-4">
          <div class="text-bold text-gray-dark mb-2">on gray</div>
          <img>
        </a>
        <a data-href="{{ url }}" class="d-block border rounded-2 bg-gray-dark px-4 pt-1 pb-2">
          <div class="text-bold text-white mb-2">on black</div>
          <img>
        </a>

      </div>

      <form id="chooser">
        <table>

          <tr>
            <th class="text-right">
              <label class="m-2" for="symbol">octicon</label>
            </th>
            <td>
              <select id="symbol" class="form-select input-block m-2">
                {% for octicon in icons %}
                  <option>{{ octicon.symbol }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>

          <tr>
            <th class="text-right">
              <label class="m-2" for="color">color</label>
            </th>
            <td>
              <select id="color" class="form-select input-block m-2">
                {% for color in colors %}
                  <option value="{{ color.name }}">{{ color.name }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>

          <tr>
            <th class="text-right">
              <label class="m-2" for="size">size</label>
            </th>
            <td>
              <select id="size" class="form-select input-block m-2">
                {% for size in sizes %}
                  <option value="{{ size }}">{{ size }}x{{ size }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>

          <tr>
            <th class="text-right">
              <label class="m-2" for="format">format</label>
            </th>
            <td>
              <select id="format" class="form-select input-block m-2">
                <option value="svg">SVG (vector)</option>
                <option value="png">PNG (bitmap)</option>
              </select>
            </td>
          </tr>

        </table>
      </form>

    </div>

    <script>
      var form = document.getElementById('chooser')
      var links = document.querySelectorAll('a[data-href]')

      set('color', 'black')

      if (location.search) {
        try {
          var params = new URL(location.href).searchParams
          Array.from(params.keys()).forEach(function(key) {
            set(key, params.get(key))
          })
        } catch (error) {
          console.warn('unable to get search params:', error)
        }
      }

      update()
      form.addEventListener('change', update)

      function update() {
        var values = {}
        Array.prototype.forEach.call(
          form.elements,
          function(input) {
            values[input.name || input.id] = input.value
          }
        )
        Array.prototype.forEach.call(
          links,
          function(link) {
            var img = link.querySelector('img')
            var url = link.getAttribute('data-href')
              .replace(/{(\w+)}/g, function(_, key) {
                return values[key]
              })
            link.href = img.src = url
            img.width = img.height = values.size || 64
          }
        )
        var params = new URLSearchParams(values)
        var url = '?' + params.toString()
        history.replaceState(values, '', url)
      }

      function set(name, value) {
        Array.prototype.filter.call(
          form.elements,
          function (input) {
            return input.name === name || input.id === name
          }
        ).forEach(function (input) {
          input.value = value
        })
      }

    </script>
  </body>
</html>
